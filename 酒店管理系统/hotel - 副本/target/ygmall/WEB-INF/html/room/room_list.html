<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>房源列表</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../../x-admin/css/font.css">
    <link rel="stylesheet" href="../../../x-admin/css/xadmin.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/Swiper/3.4.2/css/swiper.min.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/Swiper/3.4.2/js/swiper.jquery.min.js"></script>
    <script type="text/javascript" src="../../../x-admin/js/xadmin.js"></script>

</head>
<body>
<!-- 顶部开始 -->
<div class="container">
    <div class="logo"><a href="">小型酒店管理系统</a></div>
    <div class="open-nav"><i class="iconfont">&#xe699;</i></div>
    <ul class="layui-nav right" lay-filter="">
        <li class="layui-nav-item">
            <a href="javascript:;" id="userName"></a>
            <dl class="layui-nav-child"> <!-- 二级菜单 -->
                <dd><a href="">个人信息</a></dd>
                <dd><a href="/manage/user/jumpUserLogin.html">切换帐号</a></dd>
                <dd><a href="/manage/user/jumpUserLogin.html">退出</a></dd>
            </dl>
        </li>
        <!--<li class="layui-nav-item"><a href="/manage/user/jumpUserShop.html">前台首页</a></li>-->
    </ul>
</div>
<!-- 顶部结束 -->
<!-- 中部开始 -->
<div class="wrapper">
    <!-- 左侧菜单开始 -->
    <div class="left-nav">
        <div id="side-nav">
            <ul id="nav">
                <li class="list" current>
                    <a id="shouye">
                        <i class="iconfont">&#xe761;</i>
                        后台首页
                        <i class="iconfont nav_right">&#xe697;</i>
                    </a>
                </li>
                <li class="list">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe60a;</i>
                        房源管理
                        <i class="iconfont nav_right">&#xe697;</i>
                    </a>
                    <ul class="sub-menu">
                        <li>
                            <a href="/manage/room/jumpRoomList.html">
                                <i class="iconfont">&#xe6a7;</i>
                                房源列表
                            </a>
                        </li>
                        <li>
                            <a href="/manage/room/jumpRoomAdd.html">
                                <i class="iconfont">&#xe6a7;</i>
                                添加房源
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="list" >
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe62b;</i>
                        入住管理
                        <i class="iconfont nav_right">&#xe697;</i>
                    </a>
                    <ul class="sub-menu">
                        <li>
                            <a href="/manage/user/jumpUserCheckInRoom.html">
                                <i class="iconfont">&#xe6a7;</i>
                                客户入住
                            </a>
                        </li>

                    </ul>
                </li>
                <li class="list" >
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe613;</i>
                        用户管理
                        <i class="iconfont nav_right">&#xe697;</i>
                    </a>
                    <ul class="sub-menu" style="display:none">
                        <li>
                            <a href="/manage/user/jumpUserList.html">
                                <i class="iconfont">&#xe6a7;</i>
                                客户列表
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <!-- 左侧菜单结束 -->
    <!-- 右侧主体开始 -->
    <div class="page-content">
        <div class="content">
            <div class="layui-form xbs" >
                <div class="layui-form-pane" style="text-align: center;">
                    <div class="layui-form-item" style="display: inline-block;">
                        <div class="layui-input-inline">
                            <input type="text" name="roomCode"id="roomCode" placeholder="请输入房源编号" autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-input-inline">
                            <input type="text" name="roomTitle" id="roomTitle" placeholder="请输入房源标题" autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-input-inline">
                            <input type="text" name="roomAddress" id="roomAddress" placeholder="请输入房间位置 如2-" autocomplete="off"
                                   class="layui-input">
                        </div>
                        <label class="layui-form-label xbs768">房源状态</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select name="roomState" id="roomState" lay-verify="roomState" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="0">空闲</option>
                                <option value="1">预约</option>
                                <option value="2">已入住</option>
                            </select>
                        </div>
                        <label class="layui-form-label xbs768">床铺类型</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select name="roomBedLength" id="roomBedLength" lay-verify="roomBedLength" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="单床">单床</option>
                                <option value="圆床">圆床</option>
                                <option value="双床">双床</option>
                            </select>
                        </div>
                        <label class="layui-form-label xbs768">房间大小</label>
                        <div class="layui-input-inline">
                            <select name="roomAreas" id="roomAreas" lay-verify="roomAreas" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="15㎡">15㎡</option>
                                <option value="18㎡">18㎡</option>
                                <option value="20㎡">20㎡</option>
                                <option value="25㎡">25㎡</option>
                                <option value="30㎡">30㎡</option>
                                <option value="33㎡">33㎡</option>
                                <option value="38㎡">38㎡</option>
                                <option value="45㎡">45㎡</option>
                            </select>
                        </div>
                        <label class="layui-form-label xbs768">是否有窗</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select name="roomIsWindow" id="roomIsWindow" lay-verify="" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="1">有窗</option>
                                <option value="0">无窗</option>
                            </select>
                        </div>
                        <label class="layui-form-label xbs768">是否含早</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select name="roomIsBreakfast" id="roomIsBreakfast" lay-verify="" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="1">含早</option>
                                <option value="0">不含早</option>
                            </select>
                        </div>
                        <label class="layui-form-label xbs768">是否有WIFI</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select name="roomIsWifi" id="roomIsWifi" lay-verify="" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="1">有WIFI</option>
                                <option value="0">无WIFI</option>
                            </select>
                        </div>
                        <label class="layui-form-label xbs768">是否有厕所</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select name="roomIsWc" id="roomIsWc" lay-verify="" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="1">有厕所</option>
                                <option value="0">无厕所</option>
                            </select>
                        </div>
                        <label class="layui-form-label xbs768">是否含电脑</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select name="roomIsPc" id="roomIsPc" lay-verify="" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="1">有电脑</option>
                                <option value="0">无电脑</option>
                            </select>
                        </div>
                        <label class="layui-form-label xbs768">是否含电视</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select name="roomIsTv" id="roomIsTv" lay-verify="" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="1">有电视</option>
                                <option value="0">无电视</option>
                            </select>
                        </div>
                        <label class="layui-form-label xbs768">是否含沙发</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <select name="roomIsSofa" id="roomIsSofa" lay-verify="" lay-search="" >
                                <option value="">请选择...</option>
                                <option value="1">有沙发</option>
                                <option value="0">无沙发</option>
                            </select>
                        </div>
                        <div class="layui-input-inline" style="width:80px">
                            <button class="layui-btn"  data-type="reload" ><i class="layui-icon">&#xe615;</i></button>
                        </div>
                    </div>
                </div>
            </div>
            <xblock>
                <div>
                    <button class="layui-btn layui-btn-danger" data-type="delAll" ><i class="layui-icon">&#xe640;</i>批量删除
                    </button>
                    <span class="x-right" style="line-height:40px" id="count"></span>
                </div>
            </xblock>
            <table class="layui-table" id="order" lay-filter="orderTable"></table>
            <script type="text/html" id="barDemo">

                {{# if(d.roomState === 1 ){ }}
                <a  title="房内照片" lay-event="photoDetail"><i class="layui-icon">&#xe64a;</i></a>
                <a  title="房内基本设施" lay-event="messageDetail"><i class="layui-icon">&#xe639;</i></a>
                <a  title="查看用户" lay-event="seeUser"><i class="layui-icon">&#xe612;</i></a>
                <a  title="删除" lay-event="del"><i class="layui-icon">&#xe640;</i></a>
                {{# }else if(d.roomState ===2 ) { }}
                <a  title="房内照片" lay-event="photoDetail"><i class="layui-icon">&#xe64a;</i></a>
                <a  title="房内基本设施" lay-event="messageDetail"><i class="layui-icon">&#xe639;</i></a>
                <a  title="查看用户" lay-event="seeUser"><i class="layui-icon">&#xe612;</i></a>
                <a  title="删除" lay-event="del"><i class="layui-icon">&#xe640;</i></a>
                {{# }else { }}
                <a  title="房内照片" lay-event="photoDetail"><i class="layui-icon">&#xe64a;</i></a>
                <a  title="房内基本设施" lay-event="messageDetail"><i class="layui-icon">&#xe639;</i></a>
                <a  title="删除" lay-event="del"><i class="layui-icon">&#xe640;</i></a>
                {{# }
                }}

            </script>
        </div>
    </div>
    <!-- 右侧主体结束 -->
</div>
<!-- 中部结束 -->
<!-- 底部开始 -->
<div class="footer">
    <div class="copyright">学校：江苏师范大学 学号：  本后台系统由张帆提供技术支持</div>
</div>
<!-- 底部结束 -->
<!-- 背景切换开始 -->
<div class="bg-changer">
    <div class="swiper-container changer-list">
        <div class="swiper-wrapper">
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/a.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/b.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/c.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/d.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/e.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/f.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/g.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/h.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/i.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/j.jpg" alt=""></div>
            <div class="swiper-slide"><img class="item" src="../../../x-admin/images/k.jpg" alt=""></div>
            <div class="swiper-slide"><span class="reset">初始化</span></div>
        </div>
    </div>
    <div class="bg-out"></div>
    <div id="changer-set"><i class="iconfont">&#xe696;</i></div>
</div>
<!-- 背景切换结束 -->
<link rel="stylesheet" href="../../../x-admin/lib/layui/css/modules/layer/default/layer.css">

<script src="../../../x-admin/lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="../../../layui/layui.js"></script>
<script>
    var userName = '${session_manage_token.getUserName()}';
    $("#userName").html( userName);
    var userRole = '${session_manage_token.getUserRole()}';
    $("#shouye").attr("href", "/manage/user/jumpUserBackStageIndex.html?userRole=" + userRole);





</script>
<script type="text/html" id="switchTpl" lay-filter="test1">
    <input type="checkbox" name="isShow" id="isShow" value="{{d.roomId}}" style="width: 80px" lay-skin="switch"  lay-filter="isShow" {{ d.roomIsUse == 1 ?'checked' : '' }}>
</script>

<style>
    .laytable-cell-1-0-6 img{ /*最后的pic为字段的field*/
        height: 70px;
        width: 70px !important;
    }
</style>
<script>
    layui.use(['table', 'laydate', 'layer', 'form'], function () {

        $ = layui.jquery;
        var table = layui.table,
            laydate = layui.laydate,
            layer = layui.layer,
            form = layui.form;

        //渲染
        table.render({
            elem: '#order'
            ,id : 'testReload'
            ,url: '/manage/room/roomList'//数据接口
            ,cols: [[
                {type: 'checkbox'}
                , {field: 'roomCode',width: '5%', title: '房间编号'}
                , {field: 'roomTitle',width: '6%', title: '房间标题'}
                , {field: 'roomAddress' ,width: '3%', title: '房间位置'}
                , {field: 'roomAreas',width: '3%', align: 'center', title: '房间大小'}
                , {field: 'roomBedLength',width: '4%',align: 'center',  title: '床铺类型与大小'}
                , {field: 'roomState',width: '4%',align: 'center',  title: '房源状态'}
                , {field: 'romImg',width: '4%', title: '房源封面照',templet:'<div><img  src="{{ d.romImg}}"></div>'}
                , {field: 'roomIsUse',width:'4%',  title: '是否启用',templet:"#switchTpl"}
                , {fixed: 'right',width:'10%',  align: 'center', title: '操作', toolbar: '#barDemo'}
            ]]
            ,page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                layout: ['limit', 'count', 'prev', 'page', 'next'] //自定义分页布局
                ,curr: 1 //设定初始在第 1 页
                ,groups: 1 //只显示 1 个连续页码
                ,limit: 10
                ,limits: [5,10,15,20]
            }  //true表示分页
            ,done: function(res, curr, count){
                //如果是异步请求数据方式，res即为你接口返回的信息。
                //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
                console.log(res);
                //得到当前页码
                console.log(curr);
                //得到数据总量
                console.log(count);
                $("[data-field='roomState']").children().each(function(){
                    if($(this).text()=='0'){
                        $(this).text("空闲")
                    }else if($(this).text()=='1') {
                        $(this).text("预约")
                    }else if($(this).text()=='2') {
                        $(this).text("已入住")
                    }
                })
                $("#count").text("共有数据：" + count+"条");
                hoverOpenImg();//显示大图 鼠标悬浮时显示大图

            }

        })
        //监听是否显示操作
        form.on('switch(isShow)', function(obj){
            var data = obj.data;
            console.log("主键Id："+this.value);
            var roomId = this.value;
            console.log("status："+ obj.elem.checked);
            var roomIsUse="";
            if(obj.elem.checked==true){
                roomIsUse=1;
            }else {
                roomIsUse=0;
            }
            layer.confirm('确定修改该房源启用状态吗？', {
                btn: ['确定','取消'] //按钮
            }, function(){//客户
                $.ajax({
                    url:'/manage/room/modifyRoomIsUseState',
                    type:'post',
                    data:{
                        roomId:roomId,
                        roomIsUse:roomIsUse
                    },
                    dataType:'json',
                    success:function (data) {
                        if(data.status==0){
                            layer.msg("状态修改成功！");
                        }else {
                            layer.msg("状态修改失败！");
                        }
                    },
                    error: function () {
                        layer.msg("报出异常！")
                    }
                });
            },function () {
                if (roomIsUse == 1) {
                    obj.elem.checked = false;
                    form.render();
                } else {
                    obj.elem.checked = true;
                    form.render();
                }
            })
        });
        table.on('tool(orderTable)', function(obj){
            var data = obj.data;
            if (obj.event === 'photoDetail') {
                localStorage.setItem("roomId", data.roomId);
                x_admin_show('房内照片详情', '/manage/room/jumpRoomPhotoDetail.html', 1200, 800);
            }else if(obj.event === 'messageDetail'){
                localStorage.setItem("roomId",data.roomId);
                x_admin_show('房内基本设施','/manage/room/jumpRoomMessageDetail.html',1200,800);
            }else if(obj.event === 'seeUser'){
                localStorage.setItem("roomId",data.roomId);
                x_admin_show('查看客户','/manage/room/jumpRoomSeeUser.html',1200,800);
            }else if(obj.event === 'del'){
                layer.confirm('确定删除此房源么？', function(index){
                    $.ajax({
                        type: 'post',
                        url: '/manage/room/deleteRoom',
                        data:{
                            roomId:data.roomId,
                        },
                        dataType: 'json',
                        success : function (data) {
                            if (data.msg == "删除成功") {
                                layer.msg("删除成功！", {
                                    icon: 6, time: 1500, end: function () {
                                        window.location.reload();
                                    }
                                })
                            } else {
                                layer.msg("删除失败！");
                            }
                        },
                        error : function () {
                            layer.msg('删除失败');
                        }
                    });
                });
            }

        });


        var $ = layui.jquery, active = {
            reload: function(){
                var roomCode = $("#roomCode").val();
                var roomTitle = $("#roomTitle").val();
                var roomAddress = $("#roomAddress").val();
                var roomState = $("#roomState option:selected").val();
                var roomBedLength = $("#roomBedLength option:selected").val();
                var roomAreas = $("#roomAreas option:selected").val();
                var roomIsWindow = $("#roomIsWindow option:selected").val();
                var roomIsBreakfast = $("#roomIsBreakfast option:selected").val();
                var roomIsWifi = $("#roomIsWifi option:selected").val();
                var roomIsWc = $("#roomIsWc option:selected").val();
                var roomIsPc = $("#roomIsPc option:selected").val();
                var roomIsTv = $("#roomIsTv option:selected").val();
                var roomIsSofa = $("#roomIsSofa option:selected").val();
                table.reload('testReload', {
                    method:'post',
                    where:{roomCode:roomCode,roomTitle:roomTitle,roomAddress:roomAddress,roomState:roomState,roomBedLength:roomBedLength,
                        roomAreas:roomAreas,roomIsWindow:roomIsWindow,roomIsBreakfast:roomIsBreakfast,roomIsWifi:roomIsWifi,roomIsWc:roomIsWc,
                        roomIsPc:roomIsPc,roomIsTv:roomIsTv,roomIsSofa:roomIsSofa}
                });
            },
            delAll: function () {
                //获取选中的数据
                var checkStatus = table.checkStatus('testReload')
                    , data = checkStatus.data;
                var ids1 = new Array();
                for (var i in data) {
                    ids1.push(data[i].roomId);
                }
                if (ids1 != '') {
                    var ids = JSON.stringify(eval(ids1));
                    layer.confirm('确定删除这些商品么？', function (index) {
                        $.ajax({
                            url: "/manage/room/deleteSomeRoom",
                            type: "post",
                            dataType: "json",
                            data:{
                                ids:ids
                            },
                            success: function (data) {
                                if (data.status == 0) {
                                    layer.msg('删除成功!', {
                                        icon: 6,
                                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                    }, function(){
                                        window.location.reload();
                                    });
                                } else {
                                    layer.msg("删除失败");
                                }
                            }
                        })
                    });
                } else {
                    layer.msg('请选择需要删除的行');
                }


            }
        };
        laydate.render({
            elem: '#startTime'
            ,type: 'datetime'
        });
        laydate.render({
            elem: '#endTime'
            ,type: 'datetime'
        });
        $('.content .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
    function hoverOpenImg(){
        var img_show = null; // tips提示
        $('td img').hover(function(){
            var kd=$(this).width();
            kd1=kd*6;          //图片放大倍数
            kd2=kd*6+30;       //图片放大倍数
            var img = "<img class='img_msg' src='"+$(this).attr('src')+"' style='width:"+kd1+"px;' />";
            img_show = layer.tips(img, this,{
                tips:[2, 'rgba(41,41,41,.5)']
                ,area: [kd2+'px']
            });
        },function(){
            layer.close(img_show);
        });
        $('td img').attr('style','max-width:70px;display:block!important');
    }

</script>

</body>
</html>